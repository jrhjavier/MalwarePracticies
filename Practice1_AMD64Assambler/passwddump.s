# as passwddump.s -o passwddump.o
# ld passwddump.o -o passwddump

.global _start

.data 
	file: 	.ascii "/etc/passwd"
	buffer:	.skip 256

.text

_start:
	### OPEN ###
	mov	$2, %rax
	mov	$file, %rdi
	mov	$0, %rdx
	mov	$0644, %rsi
	syscall	
	
	mov	%rax, %r8
	cmp	$0, %rax
	jl	error

loop:
	### READ ###	
	mov	$0, %rax
	mov	%r8, %rdi
	mov	$buffer, %rsi
	mov	$256, %rdx
	syscall

	mov	%rax, %r9
	cmp	$0, %rax
	js	error
	jz	exit

	### WRITE ###
	mov	$1, %rax
	mov	$1, %rdi
	mov	$buffer, %rsi  
	mov	%r9, %rdx
	syscall

	jmp	loop

exit:
	### CLOSE ###
	mov	$3, %rax
	mov	%r8, %rdi
	syscall

	### EXIT ###
	mov	$60, %rax
	mov	$0, %rdi
	syscall

error:
	### ERROR EXIT ###
	mov	$60, %rax
	mov	$-1, %rdi
	syscall




	
