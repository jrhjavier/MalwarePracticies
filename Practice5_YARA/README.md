# Práctica 5: YARA

Escriba las siguientes reglas básicas para YARA (versión 3 o superior), con el nombre y etiquetas indicadas, en un único fichero de reglas llamado rules.yar.

Todas las reglas tienen que tener en sus metadatos una entrada **authorname** y **authormail** con el nombre/apellidos y correo electrónico del autor.

**A) Nombre: Elf, etiqueta: practicaYARA_A**
Tiene que identificar los ficheros en formato ELF por su magic number.

**B) Nombre: PE, etiqueta: practicaYARA_B**
Tiene que identificar los ficheros ejecutables en formato PE por su magic number.

**C) Nombre: BigElf, etiqueta: practicaYARA_C**
Tiene que idenificar los ficheros ELF de más de 500 KB de tamaño.

**D) Nombre: GPL, etiqueta: practicaYARA_D**
Tiene que identificar los ficheros ELF que tienen licencia GPL 2 o 3. Para identificar estos ficheros ELF se debe buscar la cadena de texto "GNU GPL version X or later", donde X puede ser un 2 o un 3.

**E) Nombre: Bin, etiqueta: practicaYARA_E**
Tiene que identificar los ficheros que tienen los bytes 38451ea599ee seguidos de cuatro bytes (los que sean), seguidos de los bytes 59c4c30af288.

**F) Nombre: Indentation, etiqueta: practicaYARA_F**
Tiene que identificar los ficheros ELF de más de 50 KB de tamaño que tienen la cadena "program indentation level too deep" (en minúsculas, mayúsculas o mezcla de ambas).

**G) Nombre: BinOff, etiqueta: practicaYARA_G**
Tiene que identificar los ficheros que tienen los bytes 6dc87a4eadca07c3 entre las posiciones comprendidas entre los offsets 0xb7b0 y 0xb970.

**H) Nombre: Integer, etiqueta: practicaYARA_H**
Tiene que identificar los ficheros ELF menores de 20 KB que tienen al menos dos de los tres siguientes valores enteros con signo de 32 bits en Little Endian: 121000, 121002, 18821.

**I) Nombre: Regex, etiqueta: practicaYARA_I**
Tiene que identificar los ficheros que cumplan todas estas condiciones:

 1) que no sean ficheros ELF ni PE.

 2) que contengan la salida del comando ps aux de un sistema Linux. Se puede considerar que un fichero contiene la salida de ps aux si el fichero comienza por la línea:

"USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND"

 3) que la salida del comando ps aux especifique que el usuario root está ejecutando en un proceso con PID entre el 1000 y 1999, el programa "[lockd]" (última columna).

 4) que en esa salida del comando ps aux hay más de 20 procesos del usuario gdm (primera columna).

Se adjunta un fichero files.tgz con varios ficheros sobre los que hay que probar las reglas. Suponiendo que el fichero se ha descomprimido en el directorio files, debes ejecutar YARA así:

$ tar xvzf files.tgz 2> /dev/null  
$ yara -g rules.yar files  
BinOff [practicaYARA_G] files/rand1  
Elf [practicaYARA_A] files/hello  
Integer [practicaYARA_H] files/hello  
Regex [practicaYARA_I] files/ps1.txt  
Elf [practicaYARA_A] files/cat  
GPL [practicaYARA_D] files/cat  
Elf [practicaYARA_A] files/ls  
GPL [practicaYARA_D] files/ls  
Bin [practicaYARA_E] files/rand3  
Elf [practicaYARA_A] files/awk  
BigElf [practicaYARA_C] files/awk  
Indentation [practicaYARA_F] files/awk  
PE [practicaYARA_B] files/hello.exe  
$  

La opción -g permite ver las etiquetas (tags).

**Entrega: entregar un único fichero rules.yar con todas las reglas anteriores.**
